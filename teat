local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local lp = Players.LocalPlayer

local Shared = getgenv().SchmecktHubPC or {}
local key = "PlayerPanel"

local SCALE = 1
if Shared.Platform == "Mobile" then
    SCALE = 1 / 2.2
end

local function scaleUDim(x, y)
    return UDim2.new(0, x * SCALE, 0, y * SCALE)
end

local function scaleSize(s)
    return math.floor(s * SCALE)
end

if Shared.Connections and Shared.Connections[key] then
    for _, c in pairs(Shared.Connections[key]) do
        pcall(function() c:Disconnect() end)
    end
end
Shared.Connections = Shared.Connections or {}
Shared.Connections[key] = {}

if lp:WaitForChild("PlayerGui"):FindFirstChild("PlayerPanelGui") then
    lp.PlayerGui.PlayerPanelGui:Destroy()
end

local Theme = {
    Background = Color3.fromRGB(20, 5, 15),
    Card = Color3.fromRGB(45, 12, 35),
    Accent = Color3.fromRGB(255, 20, 147),
    Purple = Color3.fromRGB(180, 50, 255),
    Text = Color3.fromRGB(255, 255, 255),
    SubText = Color3.fromRGB(255, 150, 180),
    Stroke = Color3.fromRGB(150, 30, 100),
    Shadow = Color3.fromRGB(0, 0, 0)
}

local LOGO_ASSET = "rbxassetid://121759217057084"
local LOGO2_ASSET = "rbxassetid://118676632373972"

local PlayerPanelGui = Instance.new("ScreenGui")
PlayerPanelGui.Name = "PlayerPanelGui"
PlayerPanelGui.ResetOnSpawn = false
PlayerPanelGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
PlayerPanelGui.Parent = lp:WaitForChild("PlayerGui")

local MainShadow = Instance.new("Frame")
MainShadow.Name = "Shadow"
MainShadow.Size = scaleUDim(260, 340)
MainShadow.Position = UDim2.new(0, 10 * SCALE, 0.5, -(170 * SCALE))
MainShadow.BackgroundColor3 = Theme.Shadow
MainShadow.BackgroundTransparency = 0.5
MainShadow.BorderSizePixel = 0
MainShadow.Parent = PlayerPanelGui
Instance.new("UICorner", MainShadow).CornerRadius = UDim.new(0, 16 * SCALE)

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = scaleUDim(250, 330)
MainFrame.Position = UDim2.new(0, 15 * SCALE, 0.5, -(165 * SCALE))
MainFrame.BackgroundColor3 = Theme.Background
MainFrame.BackgroundTransparency = 0.02
MainFrame.BorderSizePixel = 0
MainFrame.Parent = PlayerPanelGui

Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 14 * SCALE)

local MainStroke = Instance.new("UIStroke")
MainStroke.Thickness = 2 * SCALE
MainStroke.Transparency = 0
MainStroke.Parent = MainFrame

local mainStrokeGrad = Instance.new("UIGradient")
mainStrokeGrad.Rotation = 90
mainStrokeGrad.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 20, 147)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(180, 50, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 20, 60))
})
mainStrokeGrad.Parent = MainStroke

local HeaderFrame = Instance.new("Frame")
HeaderFrame.Name = "Header"
HeaderFrame.Size = UDim2.new(1, 0, 0, 50 * SCALE)
HeaderFrame.BackgroundColor3 = Theme.Card
HeaderFrame.BorderSizePixel = 0
HeaderFrame.Parent = MainFrame
Instance.new("UICorner", HeaderFrame).CornerRadius = UDim.new(0, 14 * SCALE)

local headerGlow = Instance.new("Frame")
headerGlow.Size = UDim2.new(1, 0, 1, 0)
headerGlow.BackgroundColor3 = Theme.Purple
headerGlow.BackgroundTransparency = 0.88
headerGlow.BorderSizePixel = 0
headerGlow.Parent = HeaderFrame
Instance.new("UICorner", headerGlow).CornerRadius = UDim.new(0, 14 * SCALE)

local HeaderLogo1 = Instance.new("ImageLabel")
HeaderLogo1.Size = scaleUDim(28, 28)
HeaderLogo1.Position = UDim2.new(0, 10 * SCALE, 0.5, -(14 * SCALE))
HeaderLogo1.BackgroundColor3 = Theme.Background
HeaderLogo1.Image = LOGO_ASSET
HeaderLogo1.ScaleType = Enum.ScaleType.Crop
HeaderLogo1.Parent = HeaderFrame
Instance.new("UICorner", HeaderLogo1).CornerRadius = UDim.new(0, 6 * SCALE)

local HeaderX = Instance.new("TextLabel")
HeaderX.Size = scaleUDim(14, 28)
HeaderX.Position = UDim2.new(0, 40 * SCALE, 0.5, -(14 * SCALE))
HeaderX.BackgroundTransparency = 1
HeaderX.Text = "X"
HeaderX.Font = Enum.Font.GothamBlack
HeaderX.TextSize = scaleSize(10)
HeaderX.TextColor3 = Theme.Purple
HeaderX.Parent = HeaderFrame

local HeaderLogo2 = Instance.new("ImageLabel")
HeaderLogo2.Size = scaleUDim(24, 24)
HeaderLogo2.Position = UDim2.new(0, 56 * SCALE, 0.5, -(12 * SCALE))
HeaderLogo2.BackgroundTransparency = 1
HeaderLogo2.Image = LOGO2_ASSET
HeaderLogo2.ScaleType = Enum.ScaleType.Fit
HeaderLogo2.Parent = HeaderFrame
Instance.new("UICorner", HeaderLogo2).CornerRadius = UDim.new(1, 0)

local HeaderText = Instance.new("TextLabel")
HeaderText.Size = UDim2.new(1, -(90 * SCALE), 0, 18 * SCALE)
HeaderText.Position = UDim2.new(0, 88 * SCALE, 0, 8 * SCALE)
HeaderText.BackgroundTransparency = 1
HeaderText.Text = "PLAYER PANEL"
HeaderText.Font = Enum.Font.GothamBlack
HeaderText.TextSize = scaleSize(11)
HeaderText.TextColor3 = Theme.Accent
HeaderText.TextXAlignment = Enum.TextXAlignment.Left
HeaderText.Parent = HeaderFrame

local HeaderSub = Instance.new("TextLabel")
HeaderSub.Size = UDim2.new(1, -(90 * SCALE), 0, 14 * SCALE)
HeaderSub.Position = UDim2.new(0, 88 * SCALE, 0, 26 * SCALE)
HeaderSub.BackgroundTransparency = 1
HeaderSub.Text = "Meulios X ShadowPepper"
HeaderSub.Font = Enum.Font.GothamMedium
HeaderSub.TextSize = scaleSize(9)
HeaderSub.TextColor3 = Theme.SubText
HeaderSub.TextXAlignment = Enum.TextXAlignment.Left
HeaderSub.Parent = HeaderFrame

local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Name = "PlayerList"
ScrollFrame.Size = UDim2.new(1, -(16 * SCALE), 1, -(60 * SCALE))
ScrollFrame.Position = UDim2.new(0, 8 * SCALE, 0, 55 * SCALE)
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.BorderSizePixel = 0
ScrollFrame.ScrollBarThickness = 4 * SCALE
ScrollFrame.ScrollBarImageColor3 = Theme.Purple
ScrollFrame.ScrollBarImageTransparency = 0.3
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
ScrollFrame.Parent = MainFrame

local ListLayout = Instance.new("UIListLayout")
ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
ListLayout.Padding = UDim.new(0, 6 * SCALE)
ListLayout.Parent = ScrollFrame

local function createPlayerCard(player)
    if player == lp then return end
    
    local Card = Instance.new("Frame")
    Card.Name = player.Name
    Card.Size = UDim2.new(1, 0, 0, 50 * SCALE)
    Card.BackgroundColor3 = Theme.Card
    Card.BorderSizePixel = 0
    Card.Parent = ScrollFrame
    Instance.new("UICorner", Card).CornerRadius = UDim.new(0, 10 * SCALE)

    local CardStroke = Instance.new("UIStroke")
    CardStroke.Color = Theme.Stroke
    CardStroke.Thickness = 1.5 * SCALE
    CardStroke.Transparency = 0.3
    CardStroke.Parent = Card
    
    local Avatar = Instance.new("ImageLabel")
    Avatar.Size = scaleUDim(34, 34)
    Avatar.Position = UDim2.new(0, 8 * SCALE, 0.5, -(17 * SCALE))
    Avatar.BackgroundColor3 = Theme.Background
    Avatar.BorderSizePixel = 0
    Avatar.Parent = Card
    Instance.new("UICorner", Avatar).CornerRadius = UDim.new(1, 0)
    
    task.spawn(function()
        local ok, img = pcall(function() return Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100) end)
        if ok and img then Avatar.Image = img end
    end)
    
    local NameLabel = Instance.new("TextLabel")
    NameLabel.Size = UDim2.new(1, -(120 * SCALE), 0, 16 * SCALE)
    NameLabel.Position = UDim2.new(0, 50 * SCALE, 0, 8 * SCALE)
    NameLabel.BackgroundTransparency = 1
    NameLabel.Text = player.DisplayName
    NameLabel.Font = Enum.Font.GothamBold
    NameLabel.TextSize = scaleSize(12)
    NameLabel.TextColor3 = Theme.Text
    NameLabel.TextXAlignment = Enum.TextXAlignment.Left
    NameLabel.TextTruncate = Enum.TextTruncate.AtEnd
    NameLabel.Parent = Card
    
    local UserLabel = Instance.new("TextLabel")
    UserLabel.Size = UDim2.new(1, -(120 * SCALE), 0, 14 * SCALE)
    UserLabel.Position = UDim2.new(0, 50 * SCALE, 0, 24 * SCALE)
    UserLabel.BackgroundTransparency = 1
    UserLabel.Text = "@" .. player.Name
    UserLabel.Font = Enum.Font.Gotham
    UserLabel.TextSize = scaleSize(10)
    UserLabel.TextColor3 = Theme.SubText
    UserLabel.TextXAlignment = Enum.TextXAlignment.Left
    UserLabel.TextTruncate = Enum.TextTruncate.AtEnd
    UserLabel.Parent = Card
    
    local function createBtn(txt, pos, callback)
        local btn = Instance.new("TextButton")
        btn.Size = scaleUDim(32, 20)
        btn.Position = pos
        btn.BackgroundColor3 = Theme.Purple
        btn.Text = txt
        btn.Font = Enum.Font.GothamBlack
        btn.TextSize = scaleSize(9)
        btn.TextColor3 = Theme.Text
        btn.Parent = Card
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4 * SCALE)
        btn.MouseButton1Click:Connect(callback)
    end
    
    createBtn("OTO", UDim2.new(1, -(75 * SCALE), 0.5, -(10 * SCALE)), function()
        if lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            lp.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
        end
    end)
    
    createBtn("VIEW", UDim2.new(1, -(38 * SCALE), 0.5, -(10 * SCALE)), function()
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            Workspace.CurrentCamera.CameraSubject = player.Character.Humanoid
        end
    end)
    
    return Card
end

local function updateList()
    for _, c in pairs(ScrollFrame:GetChildren()) do
        if c:IsA("Frame") then c:Destroy() end
    end
    for _, p in pairs(Players:GetPlayers()) do
        createPlayerCard(p)
    end
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, ListLayout.AbsoluteContentSize.Y + (10 * SCALE))
end

updateList()

Players.PlayerAdded:Connect(updateList)
Players.PlayerRemoving:Connect(updateList)

local dragging, dragInput, dragStart, startPos, shadowStartPos
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        shadowStartPos = MainShadow.Position
    end
end)
MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        MainShadow.Position = UDim2.new(shadowStartPos.X.Scale, shadowStartPos.X.Offset + delta.X, shadowStartPos.Y.Scale, shadowStartPos.Y.Offset + delta.Y)
    end
end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainShadow.Size = UDim2.new(0, 0, 0, 0)
MainShadow.BackgroundTransparency = 1
TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = scaleUDim(250, 330)}):Play()
TweenService:Create(MainShadow, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = scaleUDim(260, 340)}):Play()
TweenService:Create(MainShadow, TweenInfo.new(0.5, Enum.EasingStyle.Quad), {BackgroundTransparency = 0.5}):Play()

local cleanupListener
cleanupListener = RunService.RenderStepped:Connect(function()
    if not Shared.PlayerPanel then
        if PlayerPanelGui then PlayerPanelGui:Destroy() end
        cleanupListener:Disconnect()
        if Shared.Connections[key] then
            for _, c in pairs(Shared.Connections[key]) do pcall(function() c:Disconnect() end) end
            Shared.Connections[key] = {}
        end
    end
end)
table.insert(Shared.Connections[key], cleanupListener)

local mainColorPhase = 0
local mainColorConnection = RunService.Heartbeat:Connect(function(dt)
    if not MainFrame.Parent then
        mainColorConnection:Disconnect()
        return
    end
    mainColorPhase = (mainColorPhase + dt * 0.6) % 1
    local function lerpColor(t)
        local colors = {
            Color3.fromRGB(255, 20, 147),
            Color3.fromRGB(220, 20, 60),
            Color3.fromRGB(180, 50, 255),
            Color3.fromRGB(255, 105, 180),
        }
        local index = math.floor(t * #colors) + 1
        local nextIndex = (index % #colors) + 1
        local localT = (t * #colors) % 1
        return colors[index]:Lerp(colors[nextIndex], localT)
    end
    local o1 = mainColorPhase
    local o2 = (mainColorPhase + 0.33) % 1
    local o3 = (mainColorPhase + 0.66) % 1
    mainStrokeGrad.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, lerpColor(o1)),
        ColorSequenceKeypoint.new(0.5, lerpColor(o2)),
        ColorSequenceKeypoint.new(1, lerpColor(o3))
    })
end)
table.insert(Shared.Connections[key], mainColorConnection)
